function Vigilant(){var a=this;a.activeReporter=null;a.reportOnlyActive=false;a.reporters=[];a.watchEvents=[];a.broadcast=function(b){};return a}function Reporter(b){var a=this;a.name=b;a.currentChain=[];a.handlesChain=false;a.accepts=["keypress","keydown","keyup"];a.markAsActive=function(){};return a}function Mission(b){var a=this;a.name=b;a.requiresChain=null;a.success=function(){};a.chainDrop=function(){};return a}Vigilant.prototype.getReporterIndex=function(b){for(var a=0;a<this.reporters.length;a++){if(this.reporters[a]==b){return a}}return -1};Vigilant.prototype.setActiveReporter=function(b){var a=this.reporters[b];this.activeReporter=a;a.markAsActive()};Vigilant.prototype.handleKeyDown=function(a){this.notifyReporter("keydown",a)};Vigilant.prototype.handleKeyUp=function(a){this.notifyReporter("keyup",a)};Vigilant.prototype.handleKeyPress=function(a){this.notifyReporter("keypress",a)};Vigilant.prototype.notifyReporter=function(b,d){if(this.watchEvents.length===0||this.watchEvents.indexOf(b)>-1){if(this.reportOnlyActive){if(this.activeReporter&&this.activeReporter.accepts.indexOf(b)>=0){this.activeReporter.report(b,this.getKeyAbbr(d))}}else{for(var c=0;c<this.reporters.length;c++){var a=this.reporters[c];if(a.accepts.indexOf(b)>=0){a.report(b,this.getKeyAbbr(d))}}}this.broadcast(this.getKeyAbbr(d))}};Vigilant.prototype.getKeyAbbr=function(b,d,c){if(!c){c=false}if(!d){d=false}var a="";if(b.altGraphKey){a+=!d?"a":"g"}if(b.altKey){a+="a"}if(b.ctrlKey){a+="c"}if(b.shiftKey){a+="s"}if(a.length>0){a+="+"}if(c){}a+=b.keyIdentifier.indexOf("+")==-1?b.keyIdentifier:String.fromCharCode(b.which);return a};Vigilant.prototype.watch=function(a){if(this.watchEvents.length===0||this.watchEvents.indexOf("keydown")>-1){a.onkeydown=this.handleKeyDown.bind(this)}if(this.watchEvents.length===0||this.watchEvents.indexOf("keyup")>-1){a.onkeyup=this.handleKeyUp.bind(this)}if(this.watchEvents.length===0||this.watchEvents.indexOf("keypress")>-1){a.onkeypress=this.handleKeyPress.bind(this)}};Reporter.prototype.clearChain=function(a,b){this.currentChain=[]};Reporter.prototype.report=function(a,e){if(this.handlesChain){this.currentChain.push(e)}var h=false;for(var b=0;b<this.missions.length;b++){var g=this.missions[b];if(this.handlesChain&&g.requiresChain){var d=true;for(var f=0;f<this.currentChain.length;f++){d=d&&(this.currentChain[f]==g.requiresChain[f]);if(!d){break}}if(d){h=true;if(this.currentChain.length==g.requiresChain.length){this.clearChain();g.success()}}}else{if(g.expectingData==e){h=true;g.success()}}}if(!h){if(this.onchaindropped){this.onchaindropped(this.currentChain,e)}this.clearChain()}else{if(this.onpath){this.onpath(this.currentChain,e)}}};