function Vigilant(){var e=this;e.activeReporter=null;e.reportOnlyActive=false;e.reporters=[];e.watchEvents=[];e.broadcast=function(e){};return e}function Reporter(e){var t=this;t.name=e;t.currentChain=[];t.handlesChain=false;t.accepts=["keypress","keydown","keyup"];t.markAsActive=function(){};return t}function Mission(e){var t=this;t.name=e;t.requiresChain=null;t.success=function(){};t.chainDrop=function(){};return t}Vigilant.prototype.getReporterIndex=function(e){for(var t=0;t<this.reporters.length;t++){if(this.reporters[t]==e)return t}return-1};Vigilant.prototype.setActiveReporter=function(e){var t=this.reporters[e];this.activeReporter=t;t.markAsActive()};Vigilant.prototype.handleKeyDown=function(e){this.notifyReporter("keydown",e)};Vigilant.prototype.handleKeyUp=function(e){this.notifyReporter("keyup",e)};Vigilant.prototype.handleKeyPress=function(e){this.notifyReporter("keypress",e)};Vigilant.prototype.notifyReporter=function(e,t){if(this.watchEvents.length===0||this.watchEvents.indexOf(e)>-1){if(this.reportOnlyActive){if(this.activeReporter&&this.activeReporter.accepts.indexOf(e)>=0)this.activeReporter.report(e,this.getKeyAbbr(t))}else{for(var n=0;n<this.reporters.length;n++){var r=this.reporters[n];if(r.accepts.indexOf(e)>=0)r.report(e,this.getKeyAbbr(t))}}this.broadcast(this.getKeyAbbr(t))}};Vigilant.prototype.getKeyAbbr=function(e,t,n){if(!n)n=false;if(!t)t=false;var r="";if(e.altGraphKey)r+=!t?"a":"g";if(e.altKey)r+="a";if(e.ctrlKey)r+="c";if(e.shiftKey)r+="s";if(r.length>0)r+="+";if(n){}var i="";if(!e.keyIdentifier){var s=e.which||e.charCode||e.keyCode||0;i=this.fromKeyCode(s);debugger}else{i=e.keyIdentifier.indexOf("+")==-1?e.keyIdentifier:String.fromCharCode(e.which)}if(e.type=="keyup"){i=i.toUpperCase()}r+=i;return r};Vigilant.prototype.watch=function(e){if(this.watchEvents.length===0||this.watchEvents.indexOf("keydown")>-1)e.onkeydown=this.handleKeyDown.bind(this);if(this.watchEvents.length===0||this.watchEvents.indexOf("keyup")>-1)e.onkeyup=this.handleKeyUp.bind(this);if(this.watchEvents.length===0||this.watchEvents.indexOf("keypress")>-1)e.onkeypress=this.handleKeyPress.bind(this)};Reporter.prototype.clearChain=function(e,t){this.currentChain=[]};Reporter.prototype.report=function(e,t){if(this.handlesChain)this.currentChain.push(t);var n=false;for(var r=0;r<this.missions.length;r++){var i=this.missions[r];if(this.handlesChain&&i.requiresChain){var s=true;for(var o=0;o<this.currentChain.length;o++){s=s&&this.currentChain[o]==i.requiresChain[o];if(!s)break}if(s){n=true;if(this.currentChain.length==i.requiresChain.length){this.clearChain();i.success()}}}else{if(i.expectingData==t){n=true;i.success()}}}if(!n){if(this.onchaindropped)this.onchaindropped(this.currentChain,t);this.clearChain()}else{if(this.onpath)this.onpath(this.currentChain,t)}};Vigilant.prototype.fromKeyCode=function(e){if(47<=e&&e<=90)return unescape("%"+e.toString(16));if(96<=e&&e<=105)return"NUM "+(e-96);if(112<=e&&e<=135)return"F"+(e-111);if(e==3)return"Cancel";if(e==6)return"Help";if(e==8)return"Backspace";if(e==9)return"Tab";if(e==12)return"NUM 5";if(e==13)return"Enter";if(e==16)return"Shift";if(e==17)return"Ctrl";if(e==18)return"Alt";if(e==19)return"Pause|Break";if(e==20)return"CapsLock";if(e==27)return"Esc";if(e==32)return"Space";if(e==33)return"PageUp";if(e==34)return"PageDown";if(e==35)return"End";if(e==36)return"Home";if(e==37)return"Left";if(e==38)return"Up";if(e==39)return"Right";if(e==40)return"Down";if(e==42)return"*";if(e==43)return"+";if(e==44)return"PrntScrn";if(e==45)return"Insert";if(e==46)return"Delete";if(e==91)return"WIN";if(e==92)return"WINR";if(e==93)return"WINM";if(e==106)return"*";if(e==107)return"+";if(e==108)return"Separator";if(e==109)return"-";if(e==110)return".";if(e==111)return"/";if(e==144)return"NumLock";if(e==145)return"ScrollLock";if(e==173)return"ToggleMute";if(e==174)return"VolumeDown";if(e==175)return"VolumeUp";if(e==176)return"Next";if(e==177)return"Previous";if(e==178)return"Stop";if(e==179)return"Pause";if(e==182)return"MyPc";if(e==183)return"Calc";if(e==186)return";";if(e==187)return"=";if(e==188)return",";if(e==189)return"-";if(e==190)return".";if(e==191)return"/";if(e==192)return"'";if(e==219)return"[";if(e==220)return"\\";if(e==221)return"]";if(e==222)return"'";if(e==224)return"CMD";if(e==229)return"IME";if(e==255)return"Custom";return null}